---
title: Spring Cloud æ€»ç»“
date: 2021-10-20T14:21:26+08:00
lastmod: 2021-10-26T14:21:26+08:00
author: Aaron
avatar: /me/yy.jpg
cover: /img/springcloud.jfif
images:
  - /img/springcloud.jfif
categories:
  - å¾®æœåŠ¡
tags:
  - å¾®æœåŠ¡
weight: 1
---

é¦–å…ˆæˆ‘ç»™å¤§å®¶çœ‹ä¸€å¼ å›¾ï¼Œå¦‚æœå¤§å®¶å¯¹è¿™å¼ å›¾æœ‰äº›åœ°æ–¹ä¸å¤ªç†è§£çš„è¯ï¼Œæˆ‘å¸Œæœ›ä½ ä»¬çœ‹å®Œæˆ‘è¿™ç¯‡æ–‡ç« ä¼šæç„¶å¤§æ‚Ÿã€‚

![Spring Cloud æ€»ä½“æ¶æ„](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-11/spring-cloudæ€»ä½“æ¶æ„.jpg)

## [ä»€ä¹ˆæ˜¯Spring cloud](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä»€ä¹ˆæ˜¯spring-cloud)

> æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸éœ€è¦å¤æ‚å’Œå®¹æ˜“å‡ºé”™ã€‚Spring Cloud ä¸ºæœ€å¸¸è§çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¨¡å¼æä¾›äº†ä¸€ç§ç®€å•ä¸”æ˜“äºæ¥å—çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¸®åŠ©å¼€å‘äººå‘˜æ„å»ºæœ‰å¼¹æ€§çš„ã€å¯é çš„ã€åè°ƒçš„åº”ç”¨ç¨‹åºã€‚Spring Cloud æ„å»ºäº Spring Boot ä¹‹ä¸Šï¼Œä½¿å¾—å¼€å‘è€…å¾ˆå®¹æ˜“å…¥æ‰‹å¹¶å¿«é€Ÿåº”ç”¨äºç”Ÿäº§ä¸­ã€‚

å®˜æ–¹æœç„¶å®˜æ–¹ï¼Œä»‹ç»éƒ½è¿™ä¹ˆæœ‰æ¿æœ‰çœ¼çš„ã€‚

æˆ‘æ‰€ç†è§£çš„ `Spring Cloud` å°±æ˜¯å¾®æœåŠ¡ç³»ç»Ÿæ¶æ„çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œåœ¨å¹³æ—¶æˆ‘ä»¬æ„å»ºå¾®æœåŠ¡çš„è¿‡ç¨‹ä¸­éœ€è¦åšå¦‚ **æœåŠ¡å‘ç°æ³¨å†Œ** ã€**é…ç½®ä¸­å¿ƒ** ã€**æ¶ˆæ¯æ€»çº¿** ã€**è´Ÿè½½å‡è¡¡** ã€**æ–­è·¯å™¨** ã€**æ•°æ®ç›‘æ§** ç­‰æ“ä½œï¼Œè€Œ Spring Cloud ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—ç®€æ˜“çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿æˆ‘ä»¬èƒ½åœ¨ Spring Boot çš„åŸºç¡€ä¸Šè½»æ¾åœ°å®ç°å¾®æœåŠ¡é¡¹ç›®çš„æ„å»ºã€‚

## [Spring Cloud çš„ç‰ˆæœ¬](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=spring-cloud-çš„ç‰ˆæœ¬)

å½“ç„¶è¿™ä¸ªåªæ˜¯ä¸ªé¢˜å¤–è¯ã€‚

`Spring Cloud` çš„ç‰ˆæœ¬å·å¹¶ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è§çš„æ•°å­—ç‰ˆæœ¬å·ï¼Œè€Œæ˜¯ä¸€äº›å¾ˆå¥‡æ€ªçš„å•è¯ã€‚è¿™äº›å•è¯å‡ä¸ºè‹±å›½ä¼¦æ•¦åœ°é“ç«™çš„ç«™åã€‚åŒæ—¶æ ¹æ®å­—æ¯è¡¨çš„é¡ºåºæ¥å¯¹åº”ç‰ˆæœ¬æ—¶é—´é¡ºåºï¼Œæ¯”å¦‚ï¼šæœ€æ—© çš„ `Release` ç‰ˆæœ¬ `Angel`ï¼Œç¬¬äºŒä¸ª `Release` ç‰ˆæœ¬ `Brixton`ï¼ˆè‹±å›½åœ°åï¼‰ï¼Œç„¶åæ˜¯ `Camden`ã€ `Dalston`ã€`Edgware`ã€`Finchley`ã€`Greenwich`ã€`Hoxton`ã€‚

## [Spring Cloud çš„æœåŠ¡å‘ç°æ¡†æ¶â€”â€”Eureka](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=spring-cloud-çš„æœåŠ¡å‘ç°æ¡†æ¶eureka)

> `Eureka`æ˜¯åŸºäº`REST`ï¼ˆä»£è¡¨æ€§çŠ¶æ€è½¬ç§»ï¼‰çš„æœåŠ¡ï¼Œä¸»è¦åœ¨ `AWS` äº‘ä¸­ç”¨äºå®šä½æœåŠ¡ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œä¸­é—´å±‚æœåŠ¡å™¨çš„æ•…éšœè½¬ç§»ã€‚æˆ‘ä»¬ç§°æ­¤æœåŠ¡ä¸º`Eureka`æœåŠ¡å™¨ã€‚Eurekaè¿˜å¸¦æœ‰ä¸€ä¸ªåŸºäº `Java` çš„å®¢æˆ·ç«¯ç»„ä»¶ `Eureka Client`ï¼Œå®ƒä½¿ä¸æœåŠ¡çš„äº¤äº’å˜å¾—æ›´åŠ å®¹æ˜“ã€‚å®¢æˆ·ç«¯è¿˜å…·æœ‰ä¸€ä¸ªå†…ç½®çš„è´Ÿè½½å¹³è¡¡å™¨ï¼Œå¯ä»¥æ‰§è¡ŒåŸºæœ¬çš„å¾ªç¯è´Ÿè½½å¹³è¡¡ã€‚åœ¨ `Netflix`ï¼Œæ›´å¤æ‚çš„è´Ÿè½½å‡è¡¡å™¨å°† `Eureka` åŒ…è£…èµ·æ¥ï¼Œä»¥åŸºäºæµé‡ï¼Œèµ„æºä½¿ç”¨ï¼Œé”™è¯¯æ¡ä»¶ç­‰å¤šç§å› ç´ æä¾›åŠ æƒè´Ÿè½½å‡è¡¡ï¼Œä»¥æä¾›å‡ºè‰²çš„å¼¹æ€§ã€‚

æ€»çš„æ¥è¯´ï¼Œ`Eureka` å°±æ˜¯ä¸€ä¸ªæœåŠ¡å‘ç°æ¡†æ¶ã€‚ä½•ä¸ºæœåŠ¡ï¼Œä½•åˆä¸ºå‘ç°å‘¢ï¼Ÿ

ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œå°±æ¯”å¦‚æˆ‘ä»¬å¹³æ—¶ç§Ÿæˆ¿å­æ‰¾ä¸­ä»‹çš„äº‹æƒ…ã€‚

åœ¨æ²¡æœ‰ä¸­ä»‹çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸€ä¸ªå»å¯»æ‰¾æ˜¯å¦æœ‰æˆ¿å±‹è¦å‡ºç§Ÿçš„æˆ¿ä¸œï¼Œè¿™æ˜¾ç„¶ä¼šéå¸¸çš„è´¹åŠ›ï¼Œä¸€ä½ æ‰¾å‡­ä¸€ä¸ªäººçš„èƒ½åŠ›æ˜¯æ‰¾ä¸åˆ°å¾ˆå¤šæˆ¿æºä¾›ä½ é€‰æ‹©ï¼Œå†è€…ä½ ä¹Ÿæ‡’å¾—è¿™ä¹ˆæ‰¾ä¸‹å»(æ‰¾äº†è¿™ä¹ˆä¹…ï¼Œæ²¡æœ‰åˆé€‚çš„åªèƒ½å°†å°±)ã€‚**è¿™é‡Œçš„æˆ‘ä»¬å°±ç›¸å½“äºå¾®æœåŠ¡ä¸­çš„ `Consumer` ï¼Œè€Œé‚£äº›æˆ¿ä¸œå°±ç›¸å½“äºå¾®æœåŠ¡ä¸­çš„ `Provider` ã€‚æ¶ˆè´¹è€… `Consumer` éœ€è¦è°ƒç”¨æä¾›è€… `Provider` æä¾›çš„ä¸€äº›æœåŠ¡ï¼Œå°±åƒæˆ‘ä»¬ç°åœ¨éœ€è¦ç§Ÿä»–ä»¬çš„æˆ¿å­ä¸€æ ·ã€‚**

ä½†æ˜¯å¦‚æœåªæ˜¯ç§Ÿå®¢å’Œæˆ¿ä¸œä¹‹é—´è¿›è¡Œå¯»æ‰¾çš„è¯ï¼Œä»–ä»¬çš„æ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œæˆ¿ä¸œæ‰¾ä¸åˆ°ç§Ÿå®¢èµšä¸åˆ°é’±ï¼Œç§Ÿå®¢æ‰¾ä¸åˆ°æˆ¿ä¸œä½ä¸äº†æˆ¿ã€‚æ‰€ä»¥ï¼Œåæ¥æˆ¿ä¸œè‚¯å®šå°±æƒ³åˆ°äº†å¹¿æ’­è‡ªå·±çš„æˆ¿æºä¿¡æ¯(æ¯”å¦‚åœ¨è¡—è¾¹è´´è´´å°å¹¿å‘Š)ï¼Œè¿™æ ·å¯¹äºæˆ¿ä¸œæ¥è¯´å·²ç»å®Œæˆä»–çš„ä»»åŠ¡(å°†æˆ¿æºå…¬å¸ƒå‡ºå»)ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜å°±å‡ºç°äº†ã€‚ç¬¬ä¸€ã€å…¶ä»–ä¸æ˜¯ç§Ÿå®¢çš„éƒ½èƒ½æ”¶åˆ°è¿™ç§ç§Ÿæˆ¿æ¶ˆæ¯ï¼Œè¿™åœ¨ç°å®ä¸–ç•Œæ²¡ä»€ä¹ˆï¼Œä½†æ˜¯åœ¨è®¡ç®—æœºçš„ä¸–ç•Œä¸­å°±ä¼šå‡ºç° **èµ„æºæ¶ˆè€—** çš„é—®é¢˜äº†ã€‚ç¬¬äºŒã€ç§Ÿå®¢è¿™æ ·è¿˜æ˜¯å¾ˆéš¾æ‰¾åˆ°ä½ ï¼Œè¯•æƒ³ä¸€ä¸‹æˆ‘éœ€è¦ç§Ÿæˆ¿ï¼Œæˆ‘è¿˜éœ€è¦ä¸œä¸€ä¸ªè¥¿ä¸€ä¸ªåœ°å»æ‰¾è¡—è¾¹å°å¹¿å‘Šï¼Œéº»ä¸éº»çƒ¦ï¼Ÿ

é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å½“ç„¶ä¸ä¼šé‚£ä¹ˆå‚»ä¹ä¹çš„ï¼Œç¬¬ä¸€æ—¶é—´å°±æ˜¯å»æ‰¾ **ä¸­ä»‹** å‘€ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ç»Ÿä¸€æˆ¿æºçš„åœ°æ–¹ï¼Œæˆ‘ä»¬æ¶ˆè´¹è€…åªéœ€è¦è·‘åˆ°å®ƒé‚£é‡Œå»æ‰¾å°±è¡Œäº†ã€‚è€Œå¯¹äºæˆ¿ä¸œæ¥è¯´ï¼Œä»–ä»¬ä¹Ÿåªéœ€è¦æŠŠæˆ¿æºåœ¨ä¸­ä»‹é‚£é‡Œå‘å¸ƒå°±è¡Œäº†ã€‚

![img](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-11/4d161e2950414113834f2f0a8fc2c16c-new-imaged17347a0-e653-4830-9542-3d7ae4305b2b.png)

é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬çš„æ¨¡å¼å°±æ˜¯è¿™æ ·çš„äº†ã€‚

![img](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-11/24382ce6bbd44932ac38b1accade12d1-new-image2ff8affc-6f1d-49de-a8c3-801e7bad2b11.png)

ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™è¿˜ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚

1. æˆ¿ä¸œæ³¨å†Œä¹‹åå¦‚æœä¸æƒ³å–æˆ¿å­äº†æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯éœ€è¦è®©æˆ¿ä¸œ **å®šæœŸç»­çº¦** ï¼Ÿå¦‚æœæˆ¿ä¸œä¸è¿›è¡Œç»­çº¦æ˜¯ä¸æ˜¯è¦å°†ä»–ä»¬ä»ä¸­ä»‹é‚£é‡Œçš„æ³¨å†Œåˆ—è¡¨ä¸­ **ç§»é™¤** ã€‚
2. ç§Ÿå®¢æ˜¯ä¸æ˜¯ä¹Ÿè¦è¿›è¡Œ **æ³¨å†Œ** å‘¢ï¼Ÿä¸ç„¶åˆåŒä¹™æ–¹æ€ä¹ˆæ¥å‘¢ï¼Ÿ
3. ä¸­ä»‹å¯ä¸å¯ä»¥åš **è¿é”åº—** å‘¢ï¼Ÿå¦‚æœè¿™ä¸€ä¸ªåº—å› ä¸ºæŸäº›ä¸å¯æŠ—åŠ›å› ç´ è€Œæ— æ³•ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ¢ä¸€ä¸ªè¿é”åº—å‘¢ï¼Ÿ

é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜æˆ‘ä»¬æ¥é‡æ–°æ„å»ºä¸€ä¸‹ä¸Šé¢çš„æ¨¡å¼å›¾

![ç§Ÿæˆ¿-ä¸­ä»‹æ¨¡å¼å›¾](https://gitee.com/aaronlynn/picture/raw/master/img/%E7%A7%9F%E6%88%BF-%E4%B8%AD%E4%BB%8B%E6%A8%A1%E5%BC%8F%E5%9B%BE.jpg)

å¥½äº†ï¼Œä¸¾å®Œè¿™ä¸ª![chestnut](https://github.githubassets.com/images/icons/emoji/unicode/1f330.png)æˆ‘ä»¬å°±å¯ä»¥æ¥çœ‹å…³äº `Eureka` çš„ä¸€äº›åŸºç¡€æ¦‚å¿µäº†ï¼Œä½ ä¼šå‘ç°è¿™ä¸œè¥¿ç†è§£èµ·æ¥æ€ä¹ˆè¿™ä¹ˆç®€å•ã€‚![punch](https://github.githubassets.com/images/icons/emoji/unicode/1f44a.png)![punch](https://github.githubassets.com/images/icons/emoji/unicode/1f44a.png)![punch](https://github.githubassets.com/images/icons/emoji/unicode/1f44a.png)

**æœåŠ¡å‘ç°**ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªâ€œä¸­ä»‹â€ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼š**æœåŠ¡æä¾›è€…(å‡ºç§Ÿæˆ¿å­çš„)ã€æœåŠ¡æ¶ˆè´¹è€…(ç§Ÿå®¢)ã€æœåŠ¡ä¸­ä»‹(æˆ¿å±‹ä¸­ä»‹)**ã€‚

**æœåŠ¡æä¾›è€…**ï¼š å°±æ˜¯æä¾›ä¸€äº›è‡ªå·±èƒ½å¤Ÿæ‰§è¡Œçš„ä¸€äº›æœåŠ¡ç»™å¤–ç•Œã€‚

**æœåŠ¡æ¶ˆè´¹è€…**ï¼š å°±æ˜¯éœ€è¦ä½¿ç”¨ä¸€äº›æœåŠ¡çš„â€œç”¨æˆ·â€ã€‚

**æœåŠ¡ä¸­ä»‹**ï¼š å…¶å®å°±æ˜¯æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä¹‹é—´çš„â€œæ¡¥æ¢â€ï¼ŒæœåŠ¡æä¾›è€…å¯ä»¥æŠŠè‡ªå·±æ³¨å†Œåˆ°æœåŠ¡ä¸­ä»‹é‚£é‡Œï¼Œè€ŒæœåŠ¡æ¶ˆè´¹è€…å¦‚éœ€è¦æ¶ˆè´¹ä¸€äº›æœåŠ¡(ä½¿ç”¨ä¸€äº›åŠŸèƒ½)å°±å¯ä»¥åœ¨æœåŠ¡ä¸­ä»‹ä¸­å¯»æ‰¾æ³¨å†Œåœ¨æœåŠ¡ä¸­ä»‹çš„æœåŠ¡æä¾›è€…ã€‚

**æœåŠ¡æ³¨å†Œ Register**ï¼š

å®˜æ–¹è§£é‡Šï¼šå½“ `Eureka` å®¢æˆ·ç«¯å‘ `Eureka Server` æ³¨å†Œæ—¶ï¼Œå®ƒæä¾›è‡ªèº«çš„**å…ƒæ•°æ®**ï¼Œæ¯”å¦‚IPåœ°å€ã€ç«¯å£ï¼Œè¿è¡ŒçŠ¶å†µæŒ‡ç¤ºç¬¦URLï¼Œä¸»é¡µç­‰ã€‚

ç»“åˆä¸­ä»‹ç†è§£ï¼šæˆ¿ä¸œ (æä¾›è€… `Eureka Client Provider`)åœ¨ä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) é‚£é‡Œç™»è®°æˆ¿å±‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚é¢ç§¯ï¼Œä»·æ ¼ï¼Œåœ°æ®µç­‰ç­‰(å…ƒæ•°æ® `metaData`)ã€‚

**æœåŠ¡ç»­çº¦ Renew**ï¼š

å®˜æ–¹è§£é‡Šï¼š**`Eureka` å®¢æˆ·ä¼šæ¯éš”30ç§’(é»˜è®¤æƒ…å†µä¸‹)å‘é€ä¸€æ¬¡å¿ƒè·³æ¥ç»­çº¦**ã€‚ é€šè¿‡ç»­çº¦æ¥å‘ŠçŸ¥ `Eureka Server` è¯¥ `Eureka` å®¢æˆ·ä»ç„¶å­˜åœ¨ï¼Œæ²¡æœ‰å‡ºç°é—®é¢˜ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœ `Eureka Server` åœ¨90ç§’æ²¡æœ‰æ”¶åˆ° `Eureka` å®¢æˆ·çš„ç»­çº¦ï¼Œå®ƒä¼šå°†å®ä¾‹ä»å…¶æ³¨å†Œè¡¨ä¸­åˆ é™¤ã€‚

ç»“åˆä¸­ä»‹ç†è§£ï¼šæˆ¿ä¸œ (æä¾›è€… `Eureka Client Provider`) å®šæœŸå‘Šè¯‰ä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) æˆ‘çš„æˆ¿å­è¿˜ç§Ÿ(ç»­çº¦) ï¼Œä¸­ä»‹ (æœåŠ¡å™¨`Eureka Server`) æ”¶åˆ°ä¹‹åç»§ç»­ä¿ç•™æˆ¿å±‹çš„ä¿¡æ¯ã€‚

**è·å–æ³¨å†Œåˆ—è¡¨ä¿¡æ¯ Fetch Registries**ï¼š

å®˜æ–¹è§£é‡Šï¼š`Eureka` å®¢æˆ·ç«¯ä»æœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯ï¼Œå¹¶å°†å…¶ç¼“å­˜åœ¨æœ¬åœ°ã€‚å®¢æˆ·ç«¯ä¼šä½¿ç”¨è¯¥ä¿¡æ¯æŸ¥æ‰¾å…¶ä»–æœåŠ¡ï¼Œä»è€Œè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚è¯¥æ³¨å†Œåˆ—è¡¨ä¿¡æ¯å®šæœŸï¼ˆæ¯30ç§’é’Ÿï¼‰æ›´æ–°ä¸€æ¬¡ã€‚æ¯æ¬¡è¿”å›æ³¨å†Œåˆ—è¡¨ä¿¡æ¯å¯èƒ½ä¸ `Eureka` å®¢æˆ·ç«¯çš„ç¼“å­˜ä¿¡æ¯ä¸åŒ, `Eureka` å®¢æˆ·ç«¯è‡ªåŠ¨å¤„ç†ã€‚å¦‚æœç”±äºæŸç§åŸå› å¯¼è‡´æ³¨å†Œåˆ—è¡¨ä¿¡æ¯ä¸èƒ½åŠæ—¶åŒ¹é…ï¼Œ`Eureka` å®¢æˆ·ç«¯åˆ™ä¼šé‡æ–°è·å–æ•´ä¸ªæ³¨å†Œè¡¨ä¿¡æ¯ã€‚ `Eureka` æœåŠ¡å™¨ç¼“å­˜æ³¨å†Œåˆ—è¡¨ä¿¡æ¯ï¼Œæ•´ä¸ªæ³¨å†Œè¡¨ä»¥åŠæ¯ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯è¿›è¡Œäº†å‹ç¼©ï¼Œå‹ç¼©å†…å®¹å’Œæ²¡æœ‰å‹ç¼©çš„å†…å®¹å®Œå…¨ç›¸åŒã€‚`Eureka` å®¢æˆ·ç«¯å’Œ `Eureka` æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨JSON / XMLæ ¼å¼è¿›è¡Œé€šè®¯ã€‚åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ `Eureka` å®¢æˆ·ç«¯ä½¿ç”¨å‹ç¼© `JSON` æ ¼å¼æ¥è·å–æ³¨å†Œåˆ—è¡¨çš„ä¿¡æ¯ã€‚

ç»“åˆä¸­ä»‹ç†è§£ï¼šç§Ÿå®¢(æ¶ˆè´¹è€… `Eureka Client Consumer`) å»ä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) é‚£é‡Œè·å–æ‰€æœ‰çš„æˆ¿å±‹ä¿¡æ¯åˆ—è¡¨ (å®¢æˆ·ç«¯åˆ—è¡¨ `Eureka Client List`) ï¼Œè€Œä¸”ç§Ÿå®¢ä¸ºäº†è·å–æœ€æ–°çš„ä¿¡æ¯ä¼šå®šæœŸå‘ä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) é‚£é‡Œè·å–å¹¶æ›´æ–°æœ¬åœ°åˆ—è¡¨ã€‚

**æœåŠ¡ä¸‹çº¿ Cancel**ï¼š

å®˜æ–¹è§£é‡Šï¼šEurekaå®¢æˆ·ç«¯åœ¨ç¨‹åºå…³é—­æ—¶å‘EurekaæœåŠ¡å™¨å‘é€å–æ¶ˆè¯·æ±‚ã€‚ å‘é€è¯·æ±‚åï¼Œè¯¥å®¢æˆ·ç«¯å®ä¾‹ä¿¡æ¯å°†ä»æœåŠ¡å™¨çš„å®ä¾‹æ³¨å†Œè¡¨ä¸­åˆ é™¤ã€‚è¯¥ä¸‹çº¿è¯·æ±‚ä¸ä¼šè‡ªåŠ¨å®Œæˆï¼Œå®ƒéœ€è¦è°ƒç”¨ä»¥ä¸‹å†…å®¹ï¼š`DiscoveryManager.getInstance().shutdownComponent();`

ç»“åˆä¸­ä»‹ç†è§£ï¼šæˆ¿ä¸œ (æä¾›è€… `Eureka Client Provider`) å‘Šè¯‰ä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) æˆ‘çš„æˆ¿å­ä¸ç§Ÿäº†ï¼Œä¸­ä»‹ä¹‹åå°±å°†æ³¨å†Œçš„æˆ¿å±‹ä¿¡æ¯ä»åˆ—è¡¨ä¸­å‰”é™¤ã€‚

**æœåŠ¡å‰”é™¤ Eviction**ï¼š

å®˜æ–¹è§£é‡Šï¼šåœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œ**å½“Eurekaå®¢æˆ·ç«¯è¿ç»­90ç§’(3ä¸ªç»­çº¦å‘¨æœŸ)æ²¡æœ‰å‘EurekaæœåŠ¡å™¨å‘é€æœåŠ¡ç»­çº¦ï¼Œå³å¿ƒè·³ï¼ŒEurekaæœåŠ¡å™¨ä¼šå°†è¯¥æœåŠ¡å®ä¾‹ä»æœåŠ¡æ³¨å†Œåˆ—è¡¨åˆ é™¤**ï¼Œå³æœåŠ¡å‰”é™¤ã€‚

ç»“åˆä¸­ä»‹ç†è§£ï¼šæˆ¿ä¸œ(æä¾›è€… `Eureka Client Provider`) ä¼šå®šæœŸè”ç³» ä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) å‘Šè¯‰ä»–æˆ‘çš„æˆ¿å­è¿˜ç§Ÿ(ç»­çº¦)ï¼Œå¦‚æœä¸­ä»‹ (æœåŠ¡å™¨ `Eureka Server`) é•¿æ—¶é—´æ²¡æ”¶åˆ°æä¾›è€…çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸­ä»‹ä¼šå°†ä»–çš„æˆ¿å±‹ä¿¡æ¯ç»™ä¸‹æ¶(æœåŠ¡å‰”é™¤)ã€‚

ä¸‹é¢å°±æ˜¯ `Netflix` å®˜æ–¹ç»™å‡ºçš„ `Eureka` æ¶æ„å›¾ï¼Œä½ ä¼šå‘ç°å’Œæˆ‘ä»¬å‰é¢ç”»çš„ä¸­ä»‹å›¾åˆ«æ— äºŒè‡´ã€‚

![Eurekaæ¶æ„å›¾](https://gitee.com/aaronlynn/picture/raw/master/img/5d723c49eca1468ab7b89af06743023c-new-imageb8aa3d41-fad4-4b38-add9-c304930ab285.png)

å½“ç„¶ï¼Œå¯ä»¥å……å½“æœåŠ¡å‘ç°çš„ç»„ä»¶æœ‰å¾ˆå¤šï¼š`Zookeeper` ï¼Œ`Consul` ï¼Œ `Eureka` ç­‰ã€‚

æ›´å¤šå…³äº `Eureka` çš„çŸ¥è¯†(è‡ªæˆ‘ä¿æŠ¤ï¼Œåˆå§‹æ³¨å†Œç­–ç•¥ç­‰ç­‰)å¯ä»¥è‡ªå·±å»å®˜ç½‘æŸ¥çœ‹ï¼Œæˆ–è€…æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  [æ·±å…¥ç†è§£ Eureka](https://juejin.im/post/5dd497e3f265da0ba7718018)ã€‚

## [è´Ÿè½½å‡è¡¡ä¹‹ Ribbon](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=è´Ÿè½½å‡è¡¡ä¹‹-ribbon)

### [ä»€ä¹ˆæ˜¯ `RestTemplate`?](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä»€ä¹ˆæ˜¯-resttemplate)

ä¸æ˜¯è®² `Ribbon` ä¹ˆï¼Ÿæ€ä¹ˆæ‰¯åˆ°äº† `RestTemplate` äº†ï¼Ÿä½ å…ˆåˆ«æ€¥ï¼Œå¬æˆ‘æ…¢æ…¢é“æ¥ã€‚

æˆ‘ä¸å¬æˆ‘ä¸å¬æˆ‘ä¸å¬![hear_no_evil](https://github.githubassets.com/images/icons/emoji/unicode/1f649.png)![hear_no_evil](https://github.githubassets.com/images/icons/emoji/unicode/1f649.png)![hear_no_evil](https://github.githubassets.com/images/icons/emoji/unicode/1f649.png)ã€‚

æˆ‘å°±è¯´ä¸€å¥ï¼**`RestTemplate`æ˜¯`Spring`æä¾›çš„ä¸€ä¸ªè®¿é—®HttpæœåŠ¡çš„å®¢æˆ·ç«¯ç±»**ï¼Œæ€ä¹ˆè¯´å‘¢ï¼Ÿå°±æ˜¯å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯ä½¿ç”¨çš„ `RestTemplate` ã€‚æ¯”å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ æ¶ˆè´¹è€…B éœ€è¦è°ƒç”¨ æä¾›è€…A æ‰€æä¾›çš„æœåŠ¡æˆ‘ä»¬å°±éœ€è¦è¿™ä¹ˆå†™ã€‚å¦‚æˆ‘ä¸‹é¢çš„ä¼ªä»£ç ã€‚

```java
@Autowired
private RestTemplate restTemplate;
// è¿™é‡Œæ˜¯æä¾›è€…Açš„ipåœ°å€ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº† Eureka é‚£ä¹ˆå°±åº”è¯¥æ˜¯æä¾›è€…Açš„åç§°
private static final String SERVICE_PROVIDER_A = "http://localhost:8081";

@PostMapping("/judge")
public boolean judge(@RequestBody Request request) {
    String url = SERVICE_PROVIDER_A + "/service1";
    return restTemplate.postForObject(url, request, Boolean.class);
}Copy to clipboardErrorCopied
```

å¦‚æœä½ å¯¹æºç æ„Ÿå…´è¶£çš„è¯ï¼Œä½ ä¼šå‘ç°ä¸Šé¢æˆ‘ä»¬æ‰€è®²çš„ `Eureka` æ¡†æ¶ä¸­çš„ **æ³¨å†Œ**ã€**ç»­çº¦** ç­‰ï¼Œåº•å±‚éƒ½æ˜¯ä½¿ç”¨çš„ `RestTemplate` ã€‚

### [ä¸ºä»€ä¹ˆéœ€è¦ Ribbonï¼Ÿ](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä¸ºä»€ä¹ˆéœ€è¦-ribbonï¼Ÿ)

`Ribbon` æ˜¯ `Netflix` å…¬å¸çš„ä¸€ä¸ªå¼€æºçš„è´Ÿè½½å‡è¡¡ é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯/è¿›ç¨‹å†…è´Ÿè½½å‡è¡¡å™¨ï¼Œ**è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯**ã€‚

æˆ‘ä»¬å†ä¸¾ä¸ª![chestnut](https://github.githubassets.com/images/icons/emoji/unicode/1f330.png)ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Œä½†æ˜¯ä¸ºäº†æ•´ä¸ªç³»ç»Ÿçš„ **é«˜å¯ç”¨** ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªç³»ç»Ÿåšä¸€ä¸ªé›†ç¾¤ï¼Œè€Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ¶ˆè´¹è€…å°±å¯ä»¥æ‹¥æœ‰å¤šä¸ªç§’æ€ç³»ç»Ÿçš„è°ƒç”¨é€”å¾„äº†ï¼Œå¦‚ä¸‹å›¾ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F-ribbon.jpg)

å¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ²¡æœ‰è¿›è¡Œä¸€äº› **å‡è¡¡æ“ä½œ** ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ `ç§’æ€ç³»ç»Ÿ1` è¿›è¡Œå¤§é‡çš„è°ƒç”¨ï¼Œè€Œå¦å¤–ä¸¤ä¸ªåŸºæœ¬ä¸è¯·æ±‚ï¼Œå°±ä¼šå¯¼è‡´ `ç§’æ€ç³»ç»Ÿ1` å´©æºƒï¼Œè€Œå¦å¤–ä¸¤ä¸ªå°±å˜æˆäº†å‚€å„¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦åšé›†ç¾¤ï¼Œæˆ‘ä»¬é«˜å¯ç”¨ä½“ç°çš„æ„ä¹‰åˆåœ¨å“ªå‘¢ï¼Ÿ

æ‰€ä»¥ `Ribbon` å‡ºç°äº†ï¼Œæ³¨æ„æˆ‘ä»¬ä¸Šé¢åŠ ç²—çš„å‡ ä¸ªå­—â€”â€”**è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯**ã€‚æŒ‡çš„æ˜¯ï¼Œ`Ribbon` æ˜¯è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå¦‚ä¸‹å›¾ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F-ribbon2.jpg)

å…¶å·¥ä½œåŸç†å°±æ˜¯ `Consumer` ç«¯è·å–åˆ°äº†æ‰€æœ‰çš„æœåŠ¡åˆ—è¡¨ä¹‹åï¼Œåœ¨å…¶**å†…éƒ¨**ä½¿ç”¨**è´Ÿè½½å‡è¡¡ç®—æ³•**ï¼Œè¿›è¡Œå¯¹å¤šä¸ªç³»ç»Ÿçš„è°ƒç”¨ã€‚

### [Nginx å’Œ Ribbon çš„å¯¹æ¯”](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=nginx-å’Œ-ribbon-çš„å¯¹æ¯”)

æåˆ° **è´Ÿè½½å‡è¡¡** å°±ä¸å¾—ä¸æåˆ°å¤§åé¼é¼çš„ `Nignx` äº†ï¼Œè€Œå’Œ `Ribbon` ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ç§**é›†ä¸­å¼**çš„è´Ÿè½½å‡è¡¡å™¨ã€‚

ä½•ä¸ºé›†ä¸­å¼å‘¢ï¼Ÿç®€å•ç†è§£å°±æ˜¯ **å°†æ‰€æœ‰è¯·æ±‚éƒ½é›†ä¸­èµ·æ¥ï¼Œç„¶åå†è¿›è¡Œè´Ÿè½½å‡è¡¡**ã€‚å¦‚ä¸‹å›¾ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/nginx-vs-ribbon1.jpg)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° `Nginx` æ˜¯æ¥æ”¶äº†æ‰€æœ‰çš„è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ï¼Œè€Œå¯¹äº `Ribbon` æ¥è¯´å®ƒæ˜¯åœ¨æ¶ˆè´¹è€…ç«¯è¿›è¡Œçš„è´Ÿè½½å‡è¡¡ã€‚å¦‚ä¸‹å›¾ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/nginx-vs-ribbon2.jpg)

> è¯·æ³¨æ„ `Request` çš„ä½ç½®ï¼Œåœ¨ `Nginx` ä¸­è¯·æ±‚æ˜¯å…ˆè¿›å…¥è´Ÿè½½å‡è¡¡å™¨ï¼Œè€Œåœ¨ `Ribbon` ä¸­æ˜¯å…ˆåœ¨å®¢æˆ·ç«¯è¿›è¡Œè´Ÿè½½å‡è¡¡æ‰è¿›è¡Œè¯·æ±‚çš„ã€‚

### [Ribbon çš„å‡ ç§è´Ÿè½½å‡è¡¡ç®—æ³•](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ribbon-çš„å‡ ç§è´Ÿè½½å‡è¡¡ç®—æ³•)

è´Ÿè½½å‡è¡¡ï¼Œä¸ç®¡ `Nginx` è¿˜æ˜¯ `Ribbon` éƒ½éœ€è¦å…¶ç®—æ³•çš„æ”¯æŒï¼Œå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ `Nginx` ä½¿ç”¨çš„æ˜¯ è½®è¯¢å’ŒåŠ æƒè½®è¯¢ç®—æ³•ã€‚è€Œåœ¨ `Ribbon` ä¸­æœ‰æ›´å¤šçš„è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•ï¼Œå…¶é»˜è®¤æ˜¯ä½¿ç”¨çš„ `RoundRobinRule` è½®è¯¢ç­–ç•¥ã€‚

- **`RoundRobinRule`**ï¼šè½®è¯¢ç­–ç•¥ã€‚`Ribbon` é»˜è®¤é‡‡ç”¨çš„ç­–ç•¥ã€‚è‹¥ç»è¿‡ä¸€è½®è½®è¯¢æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„ `provider`ï¼Œå…¶æœ€å¤šè½®è¯¢ 10 è½®ã€‚è‹¥æœ€ç»ˆè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› `null`ã€‚
- **`RandomRule`**: éšæœºç­–ç•¥ï¼Œä»æ‰€æœ‰å¯ç”¨çš„ `provider` ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªã€‚
- **`RetryRule`**: é‡è¯•ç­–ç•¥ã€‚å…ˆæŒ‰ç…§ `RoundRobinRule` ç­–ç•¥è·å– `provider`ï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™åœ¨æŒ‡å®šçš„æ—¶é™å†…é‡è¯•ã€‚é»˜è®¤çš„æ—¶é™ä¸º 500 æ¯«ç§’ã€‚

ğŸ¦ğŸ¦ğŸ¦ è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸ä¸€ä¸€ä¸¾![chestnut](https://github.githubassets.com/images/icons/emoji/unicode/1f330.png)äº†ï¼Œä½ æœ€éœ€è¦çŸ¥é“çš„æ˜¯é»˜è®¤è½®è¯¢ç®—æ³•ï¼Œå¹¶ä¸”å¯ä»¥æ›´æ¢é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åšå‡ºä¿®æ”¹å°±è¡Œã€‚

```yaml
providerName:
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRuleCopy to clipboardErrorCopied
```

å½“ç„¶ï¼Œåœ¨ `Ribbon` ä¸­ä½ è¿˜å¯ä»¥**è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•**ï¼Œä½ åªéœ€è¦å®ç° `IRule` æ¥å£ï¼Œç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶æˆ–è€…è‡ªå®šä¹‰ `Java Config` ç±»ã€‚

## [ä»€ä¹ˆæ˜¯ Open Feign](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä»€ä¹ˆæ˜¯-open-feign)

æœ‰äº† `Eureka` ï¼Œ`RestTemplate` ï¼Œ`Ribbon`ï¼Œ æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«åœ°è¿›è¡ŒæœåŠ¡é—´çš„è°ƒç”¨äº†ï¼Œä½†æ˜¯ä½¿ç”¨ `RestTemplate` è¿˜æ˜¯ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½è¦è¿›è¡Œè¿™æ ·çš„è°ƒç”¨ã€‚

```java
@Autowired
private RestTemplate restTemplate;
// è¿™é‡Œæ˜¯æä¾›è€…Açš„ipåœ°å€ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº† Eureka é‚£ä¹ˆå°±åº”è¯¥æ˜¯æä¾›è€…Açš„åç§°
private static final String SERVICE_PROVIDER_A = "http://localhost:8081";

@PostMapping("/judge")
public boolean judge(@RequestBody Request request) {
    String url = SERVICE_PROVIDER_A + "/service1";
    // æ˜¯ä¸æ˜¯å¤ªéº»çƒ¦äº†ï¼Ÿï¼Ÿï¼Ÿæ¯æ¬¡éƒ½è¦ urlã€è¯·æ±‚ã€è¿”å›ç±»å‹çš„ 
    return restTemplate.postForObject(url, request, Boolean.class);
}Copy to clipboardErrorCopied
```

è¿™æ ·æ¯æ¬¡éƒ½è°ƒç”¨ `RestRemplate` çš„ `API` æ˜¯å¦å¤ªéº»çƒ¦ï¼Œæˆ‘èƒ½ä¸èƒ½åƒ**è°ƒç”¨åŸæ¥ä»£ç ä¸€æ ·è¿›è¡Œå„ä¸ªæœåŠ¡é—´çš„è°ƒç”¨å‘¢ï¼Ÿ**

![bulb](https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png)![bulb](https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png)![bulb](https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png)èªæ˜çš„å°æœ‹å‹è‚¯å®šæƒ³åˆ°äº†ï¼Œé‚£å°±ç”¨ **æ˜ å°„** å‘€ï¼Œå°±åƒåŸŸåå’ŒIPåœ°å€çš„æ˜ å°„ã€‚æˆ‘ä»¬å¯ä»¥å°†è¢«è°ƒç”¨çš„æœåŠ¡ä»£ç æ˜ å°„åˆ°æ¶ˆè´¹è€…ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ **â€œæ— ç¼å¼€å‘â€ **å•¦ã€‚

> `OpenFeign` ä¹Ÿæ˜¯è¿è¡Œåœ¨æ¶ˆè´¹è€…ç«¯çš„ï¼Œä½¿ç”¨ `Ribbon` è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥ `OpenFeign` ç›´æ¥å†…ç½®äº† `Ribbon`ã€‚

åœ¨å¯¼å…¥äº† `Open Feign` ä¹‹åæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ„‰å¿«ç¼–å†™ `Consumer` ç«¯ä»£ç äº†ã€‚

```java
// ä½¿ç”¨ @FeignClient æ³¨è§£æ¥æŒ‡å®šæä¾›è€…çš„åå­—
@FeignClient(value = "eureka-client-provider")
public interface TestClient {
    // è¿™é‡Œä¸€å®šè¦æ³¨æ„éœ€è¦ä½¿ç”¨çš„æ˜¯æä¾›è€…é‚£ç«¯çš„è¯·æ±‚ç›¸å¯¹è·¯å¾„ï¼Œè¿™é‡Œå°±ç›¸å½“äºæ˜ å°„äº†
    @RequestMapping(value = "/provider/xxx",
    method = RequestMethod.POST)
    CommonResponse<List<Plan>> getPlans(@RequestBody planGetRequest request);
}Copy to clipboardErrorCopied
```

ç„¶åæˆ‘ä»¬åœ¨ `Controller` å°±å¯ä»¥åƒåŸæ¥è°ƒç”¨ `Service` å±‚ä»£ç ä¸€æ ·è°ƒç”¨å®ƒäº†ã€‚

```java
@RestController
public class TestController {
    // è¿™é‡Œå°±ç›¸å½“äºåŸæ¥è‡ªåŠ¨æ³¨å…¥çš„ Service
    @Autowired
    private TestClient testClient;
    // controller è°ƒç”¨ service å±‚ä»£ç 
    @RequestMapping(value = "/test", method = RequestMethod.POST)
    public CommonResponse<List<Plan>> get(@RequestBody planGetRequest request) {
        return testClient.getPlans(request);
    }
}Copy to clipboardErrorCopied
```

## [å¿…ä¸å¯å°‘çš„ Hystrix](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=å¿…ä¸å¯å°‘çš„-hystrix)

### [ä»€ä¹ˆæ˜¯ Hystrixä¹‹ç†”æ–­å’Œé™çº§](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä»€ä¹ˆæ˜¯-hystrixä¹‹ç†”æ–­å’Œé™çº§)

> åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸å¯é¿å…åœ°ä¼šæœ‰è®¸å¤šæœåŠ¡ä¾èµ–é¡¹ä¸­çš„æŸäº›å¤±è´¥ã€‚Hystrixæ˜¯ä¸€ä¸ªåº“ï¼Œå¯é€šè¿‡æ·»åŠ ç­‰å¾…æ—¶é—´å®¹é™å’Œå®¹é”™é€»è¾‘æ¥å¸®åŠ©æ‚¨æ§åˆ¶è¿™äº›åˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚Hystrixé€šè¿‡éš”ç¦»æœåŠ¡ä¹‹é—´çš„è®¿é—®ç‚¹ï¼Œåœæ­¢æœåŠ¡ä¹‹é—´çš„çº§è”æ•…éšœå¹¶æä¾›åå¤‡é€‰é¡¹æ¥å®ç°æ­¤ç›®çš„ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“å¼¹æ€§ã€‚

æ€»ä½“æ¥è¯´ `Hystrix` å°±æ˜¯ä¸€ä¸ªèƒ½è¿›è¡Œ **ç†”æ–­** å’Œ **é™çº§** çš„åº“ï¼Œé€šè¿‡ä½¿ç”¨å®ƒèƒ½æé«˜æ•´ä¸ªç³»ç»Ÿçš„å¼¹æ€§ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯ ç†”æ–­å’Œé™çº§ å‘¢ï¼Ÿå†ä¸¾ä¸ª![chestnut](https://github.githubassets.com/images/icons/emoji/unicode/1f330.png)ï¼Œæ­¤æ—¶æˆ‘ä»¬æ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿæ˜¯è¿™æ ·çš„ã€‚æœåŠ¡Aè°ƒç”¨äº†æœåŠ¡Bï¼ŒæœåŠ¡Bå†è°ƒç”¨äº†æœåŠ¡Cï¼Œä½†æ˜¯å› ä¸ºæŸäº›åŸå› ï¼ŒæœåŠ¡Cé¡¶ä¸ä½äº†ï¼Œè¿™ä¸ªæ—¶å€™å¤§é‡è¯·æ±‚ä¼šåœ¨æœåŠ¡Cé˜»å¡ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/Hystrix1.jpg)

æœåŠ¡Cé˜»å¡äº†è¿˜å¥½ï¼Œæ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªç³»ç»Ÿå´©æºƒäº†ã€‚ä½†æ˜¯è¯·æ³¨æ„è¿™ä¸ªæ—¶å€™å› ä¸ºæœåŠ¡Cä¸èƒ½è¿”å›å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡Bè°ƒç”¨æœåŠ¡Cçš„çš„è¯·æ±‚å°±ä¼šé˜»å¡ï¼ŒåŒç†æœåŠ¡Bé˜»å¡äº†ï¼Œé‚£ä¹ˆæœåŠ¡Aä¹Ÿä¼šé˜»å¡å´©æºƒã€‚

> è¯·æ³¨æ„ï¼Œä¸ºä»€ä¹ˆé˜»å¡ä¼šå´©æºƒã€‚å› ä¸ºè¿™äº›è¯·æ±‚ä¼šæ¶ˆè€—å ç”¨ç³»ç»Ÿçš„çº¿ç¨‹ã€IO ç­‰èµ„æºï¼Œæ¶ˆè€—å®Œä½ è¿™ä¸ªç³»ç»ŸæœåŠ¡å™¨ä¸å°±å´©äº†ä¹ˆã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/Hystrix2.jpg)

è¿™å°±å« **æœåŠ¡é›ªå´©**ã€‚å¦ˆè€¶ï¼Œä¸Šé¢ä¸¤ä¸ª **ç†”æ–­** å’Œ **é™çº§** ä½ éƒ½æ²¡ç»™æˆ‘è§£é‡Šæ¸…æ¥šï¼Œä½ ç°åœ¨åˆç»™æˆ‘æ‰¯ä»€ä¹ˆ **æœåŠ¡é›ªå´©** ï¼Ÿ![tired_face](https://github.githubassets.com/images/icons/emoji/unicode/1f62b.png)![tired_face](https://github.githubassets.com/images/icons/emoji/unicode/1f62b.png)![tired_face](https://github.githubassets.com/images/icons/emoji/unicode/1f62b.png)

åˆ«æ€¥ï¼Œå¬æˆ‘æ…¢æ…¢é“æ¥ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/513d7e7f6d574fd799195d05556f4aa7-new-image9265b6bd-41ca-4e62-86f3-4341e5bdbe6c.png)

ä¸å¬æˆ‘ä¹Ÿå¾—è®²ä¸‹å»ï¼

æ‰€è°“ **ç†”æ–­** å°±æ˜¯æœåŠ¡é›ªå´©çš„ä¸€ç§æœ‰æ•ˆè§£å†³æ–¹æ¡ˆã€‚å½“æŒ‡å®šæ—¶é—´çª—å†…çš„è¯·æ±‚å¤±è´¥ç‡è¾¾åˆ°è®¾å®šé˜ˆå€¼æ—¶ï¼Œç³»ç»Ÿå°†é€šè¿‡ **æ–­è·¯å™¨** ç›´æ¥å°†æ­¤è¯·æ±‚é“¾è·¯æ–­å¼€ã€‚

ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æœåŠ¡Bè°ƒç”¨æœåŠ¡Cåœ¨æŒ‡å®šæ—¶é—´çª—å†…ï¼Œè°ƒç”¨çš„å¤±è´¥ç‡åˆ°è¾¾äº†ä¸€å®šçš„å€¼ï¼Œé‚£ä¹ˆ `Hystrix` åˆ™ä¼šè‡ªåŠ¨å°† æœåŠ¡Bä¸C ä¹‹é—´çš„è¯·æ±‚éƒ½æ–­äº†ï¼Œä»¥å…å¯¼è‡´æœåŠ¡é›ªå´©ç°è±¡ã€‚

å…¶å®è¿™é‡Œæ‰€è®²çš„ **ç†”æ–­** å°±æ˜¯æŒ‡çš„ `Hystrix` ä¸­çš„ **æ–­è·¯å™¨æ¨¡å¼** ï¼Œä½ å¯ä»¥ä½¿ç”¨ç®€å•çš„ `@HystrixCommand` æ³¨è§£æ¥æ ‡æ³¨æŸä¸ªæ–¹æ³•ï¼Œè¿™æ · `Hystrix` å°±ä¼šä½¿ç”¨ **æ–­è·¯å™¨** æ¥â€œåŒ…è£…â€è¿™ä¸ªæ–¹æ³•ï¼Œæ¯å½“è°ƒç”¨æ—¶é—´è¶…è¿‡æŒ‡å®šæ—¶é—´æ—¶(é»˜è®¤ä¸º1000ms)ï¼Œæ–­è·¯å™¨å°†ä¼šä¸­æ–­å¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚

å½“ç„¶ä½ å¯ä»¥å¯¹è¿™ä¸ªæ³¨è§£çš„å¾ˆå¤šå±æ€§è¿›è¡Œè®¾ç½®ï¼Œæ¯”å¦‚è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåƒè¿™æ ·ã€‚

```java
@HystrixCommand(
    commandProperties = {@HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds",value = "1200")}
)
public List<Xxx> getXxxx() {
    // ...çœç•¥ä»£ç é€»è¾‘
}Copy to clipboardErrorCopied
```

ä½†æ˜¯ï¼Œæˆ‘æŸ¥é˜…äº†ä¸€äº›åšå®¢ï¼Œå‘ç°ä»–ä»¬éƒ½å°† **ç†”æ–­** å’Œ **é™çº§** çš„æ¦‚å¿µæ··æ·†äº†ï¼Œä»¥æˆ‘çš„ç†è§£ï¼Œ**é™çº§æ˜¯ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå½“ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¼‚å¸¸æ—¶ï¼Œé€šè¿‡æ‰§è¡Œå¦ä¸€ç§ä»£ç é€»è¾‘æ¥ç»™ç”¨æˆ·å‹å¥½çš„å›å¤**ã€‚è¿™ä¹Ÿå°±å¯¹åº”ç€ `Hystrix` çš„ **åå¤‡å¤„ç†** æ¨¡å¼ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® `fallbackMethod` æ¥ç»™ä¸€ä¸ªæ–¹æ³•è®¾ç½®å¤‡ç”¨çš„ä»£ç é€»è¾‘ã€‚æ¯”å¦‚è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªçƒ­ç‚¹æ–°é—»å‡ºç°äº†ï¼Œæˆ‘ä»¬ä¼šæ¨èç»™ç”¨æˆ·æŸ¥çœ‹è¯¦æƒ…ï¼Œç„¶åç”¨æˆ·ä¼šé€šè¿‡idå»æŸ¥è¯¢æ–°é—»çš„è¯¦æƒ…ï¼Œä½†æ˜¯å› ä¸ºè¿™æ¡æ–°é—»å¤ªç«äº†(æ¯”å¦‚æœ€è¿‘ä»€ä¹ˆ*æ˜“å¯¹å§)ï¼Œå¤§é‡ç”¨æˆ·åŒæ—¶è®¿é—®å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œ **æœåŠ¡é™çº§** ï¼Œä¸€äº›è¯·æ±‚ä¼šåšä¸€äº›é™çº§å¤„ç†æ¯”å¦‚å½“å‰äººæ•°å¤ªå¤šè¯·ç¨åæŸ¥çœ‹ç­‰ç­‰ã€‚

```java
// æŒ‡å®šäº†åå¤‡æ–¹æ³•è°ƒç”¨
@HystrixCommand(fallbackMethod = "getHystrixNews")
@GetMapping("/get/news")
public News getNews(@PathVariable("id") int id) {
    // è°ƒç”¨æ–°é—»ç³»ç»Ÿçš„è·å–æ–°é—»api ä»£ç é€»è¾‘çœç•¥
}
// 
public News getHystrixNews(@PathVariable("id") int id) {
    // åšæœåŠ¡é™çº§
    // è¿”å›å½“å‰äººæ•°å¤ªå¤šï¼Œè¯·ç¨åæŸ¥çœ‹
}Copy to clipboardErrorCopied
```

### [ä»€ä¹ˆæ˜¯Hystrixä¹‹å…¶ä»–](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä»€ä¹ˆæ˜¯hystrixä¹‹å…¶ä»–)

æˆ‘åœ¨é˜…è¯» ã€ŠSpringå¾®æœåŠ¡å®æˆ˜ã€‹è¿™æœ¬ä¹¦çš„æ—¶å€™è¿˜æ¥è§¦åˆ°äº†ä¸€ä¸ª **èˆ±å£æ¨¡å¼** çš„æ¦‚å¿µã€‚åœ¨ä¸ä½¿ç”¨èˆ±å£æ¨¡å¼çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡Aè°ƒç”¨æœåŠ¡Bï¼Œè¿™ç§è°ƒç”¨é»˜è®¤çš„æ˜¯ **ä½¿ç”¨åŒä¸€æ‰¹çº¿ç¨‹æ¥æ‰§è¡Œ** çš„ï¼Œè€Œåœ¨ä¸€ä¸ªæœåŠ¡å‡ºç°æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°æ‰€æœ‰çº¿ç¨‹è¢«åˆ·çˆ†å¹¶ç­‰å¾…å¤„ç†å·¥ä½œï¼ŒåŒæ—¶é˜»å¡æ–°è¯·æ±‚ï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºå´©æºƒã€‚è€Œèˆ±å£æ¨¡å¼ä¼šå°†è¿œç¨‹èµ„æºè°ƒç”¨éš”ç¦»åœ¨ä»–ä»¬è‡ªå·±çš„çº¿ç¨‹æ± ä¸­ï¼Œä»¥ä¾¿å¯ä»¥æ§åˆ¶å•ä¸ªè¡¨ç°ä¸ä½³çš„æœåŠ¡ï¼Œè€Œä¸ä¼šä½¿è¯¥ç¨‹åºå´©æºƒã€‚

å…·ä½“å…¶åŸç†æˆ‘æ¨èå¤§å®¶è‡ªå·±å»äº†è§£ä¸€ä¸‹ï¼Œæœ¬ç¯‡æ–‡ç« ä¸­å¯¹ **èˆ±å£æ¨¡å¼** ä¸åšè¿‡å¤šè§£é‡Šã€‚å½“ç„¶è¿˜æœ‰ **`Hystrix` ä»ªè¡¨ç›˜**ï¼Œå®ƒæ˜¯**ç”¨æ¥å®æ—¶ç›‘æ§ `Hystrix` çš„å„é¡¹æŒ‡æ ‡ä¿¡æ¯çš„**ï¼Œè¿™é‡Œæˆ‘å°†è¿™ä¸ªé—®é¢˜ä¹ŸæŠ›å‡ºå»ï¼Œå¸Œæœ›æœ‰ä¸äº†è§£çš„å¯ä»¥è‡ªå·±å»æœç´¢ä¸€ä¸‹ã€‚

## [å¾®æœåŠ¡ç½‘å…³â€”â€”Zuul](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=å¾®æœåŠ¡ç½‘å…³zuul)

> ZUUL æ˜¯ä»è®¾å¤‡å’Œ web ç«™ç‚¹åˆ° Netflix æµåº”ç”¨åç«¯çš„æ‰€æœ‰è¯·æ±‚çš„å‰é—¨ã€‚ä½œä¸ºè¾¹ç•ŒæœåŠ¡åº”ç”¨ï¼ŒZUUL æ˜¯ä¸ºäº†å®ç°åŠ¨æ€è·¯ç”±ã€ç›‘è§†ã€å¼¹æ€§å’Œå®‰å…¨æ€§è€Œæ„å»ºçš„ã€‚å®ƒè¿˜å…·æœ‰æ ¹æ®æƒ…å†µå°†è¯·æ±‚è·¯ç”±åˆ°å¤šä¸ª Amazon Auto Scaling Groupsï¼ˆäºšé©¬é€Šè‡ªåŠ¨ç¼©æ”¾ç»„ï¼Œäºšé©¬é€Šçš„ä¸€ç§äº‘è®¡ç®—æ–¹å¼ï¼‰ çš„èƒ½åŠ›

åœ¨ä¸Šé¢æˆ‘ä»¬å­¦ä¹ äº† `Eureka` ä¹‹åæˆ‘ä»¬çŸ¥é“äº† *æœåŠ¡æä¾›è€…* æ˜¯ *æ¶ˆè´¹è€…* é€šè¿‡ `Eureka Server` è¿›è¡Œè®¿é—®çš„ï¼Œå³ `Eureka Server` æ˜¯ *æœåŠ¡æä¾›è€…* çš„ç»Ÿä¸€å…¥å£ã€‚é‚£ä¹ˆæ•´ä¸ªåº”ç”¨ä¸­å­˜åœ¨é‚£ä¹ˆå¤š *æ¶ˆè´¹è€…* éœ€è¦ç”¨æˆ·è¿›è¡Œè°ƒç”¨ï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·è¯¥æ€æ ·è®¿é—®è¿™äº› *æ¶ˆè´¹è€…å·¥ç¨‹* å‘¢ï¼Ÿå½“ç„¶å¯ä»¥åƒä¹‹å‰é‚£æ ·ç›´æ¥è®¿é—®è¿™äº›å·¥ç¨‹ã€‚ä½†è¿™ç§æ–¹å¼æ²¡æœ‰ç»Ÿä¸€çš„æ¶ˆè´¹è€…å·¥ç¨‹è°ƒç”¨å…¥å£ï¼Œä¸ä¾¿äºè®¿é—®ä¸ç®¡ç†ï¼Œè€Œ Zuul å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªå¯¹äº *æ¶ˆè´¹è€…* çš„ç»Ÿä¸€å…¥å£ã€‚

> å¦‚æœå­¦è¿‡å‰ç«¯çš„è‚¯å®šéƒ½çŸ¥é“ Router å§ï¼Œæ¯”å¦‚ Flutter ä¸­çš„è·¯ç”±ï¼ŒVueï¼ŒReactä¸­çš„è·¯ç”±ï¼Œç”¨äº† Zuul ä½ ä¼šå‘ç°åœ¨è·¯ç”±åŠŸèƒ½æ–¹é¢å’Œå‰ç«¯é…ç½®è·¯ç”±åŸºæœ¬æ˜¯ä¸€ä¸ªç†ã€‚![smile](https://gitee.com/aaronlynn/picture/raw/master/img/1f604.png) æˆ‘å¶å°”æ’¸æ’¸ Flutterã€‚

å¤§å®¶å¯¹ç½‘å…³åº”è¯¥å¾ˆç†Ÿå§ï¼Œç®€å•æ¥è®²ç½‘å…³æ˜¯ç³»ç»Ÿå”¯ä¸€å¯¹å¤–çš„å…¥å£ï¼Œä»‹äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯ä¹‹é—´ï¼Œç”¨äºå¯¹è¯·æ±‚è¿›è¡Œ**é‰´æƒ**ã€**é™æµ**ã€ **è·¯ç”±**ã€**ç›‘æ§**ç­‰åŠŸèƒ½ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/zuul-sj22o93nfdsjkdsf.jpg)

æ²¡é”™ï¼Œç½‘å…³æœ‰çš„åŠŸèƒ½ï¼Œ`Zuul` åŸºæœ¬éƒ½æœ‰ã€‚è€Œ `Zuul` ä¸­æœ€å…³é”®çš„å°±æ˜¯ **è·¯ç”±å’Œè¿‡æ»¤å™¨** äº†ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ `Zuul` çš„æ ‡é¢˜å°±æ˜¯

> Router and Filter : Zuul

### [Zuul çš„è·¯ç”±åŠŸèƒ½](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=zuul-çš„è·¯ç”±åŠŸèƒ½)

#### [ç®€å•é…ç½®](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ç®€å•é…ç½®)

æœ¬æ¥æƒ³ç»™ä½ ä»¬å¤åˆ¶ä¸€äº›ä»£ç ï¼Œä½†æ˜¯æƒ³äº†æƒ³ï¼Œå› ä¸ºå„ä¸ªä»£ç é…ç½®æ¯”è¾ƒé›¶æ•£ï¼Œçœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒé›¶æ•£ï¼Œæˆ‘å†³å®šè¿˜æ˜¯ç»™ä½ ä»¬ç”»ä¸ªå›¾æ¥è§£é‡Šå§ã€‚

> è¯·ä¸è¦å› ä¸ºæˆ‘è¿™ä¹ˆå¥½å°±ç»™æˆ‘ç‚¹èµ ![thumbsup](https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png) ã€‚ ç–¯ç‹‚æš—ç¤ºã€‚

æ¯”å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å·²ç»å‘ `Eureka Server` æ³¨å†Œäº†ä¸¤ä¸ª `Consumer` ã€ä¸‰ä¸ª `Provicer` ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†åŠ ä¸ª `Zuul` ç½‘å…³åº”è¯¥å˜æˆè¿™æ ·å­äº†ã€‚

![img](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-11/zuul-sj22o93nfdsjkdsf2312.jpg)

emmmï¼Œä¿¡æ¯é‡æœ‰ç‚¹å¤§ï¼Œæˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚å…³äºå‰é¢çš„çŸ¥è¯†æˆ‘å°±ä¸è§£é‡Šäº†![neutral_face](https://gitee.com/aaronlynn/picture/raw/master/img/1f610.png)ã€‚

é¦–å…ˆï¼Œ`Zuul` éœ€è¦å‘ `Eureka` è¿›è¡Œæ³¨å†Œï¼Œæ³¨å†Œæœ‰å•¥å¥½å¤„å‘¢ï¼Ÿ

ä½ å‚»å‘€ï¼Œ`Consumer` éƒ½å‘ `Eureka Server` è¿›è¡Œæ³¨å†Œäº†ï¼Œæˆ‘ç½‘å…³æ˜¯ä¸æ˜¯åªè¦æ³¨å†Œå°±èƒ½æ‹¿åˆ°æ‰€æœ‰ `Consumer` çš„ä¿¡æ¯äº†ï¼Ÿ

æ‹¿åˆ°ä¿¡æ¯æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ

æˆ‘æ‹¿åˆ°ä¿¡æ¯æˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è·å–æ‰€æœ‰çš„ `Consumer` çš„å…ƒæ•°æ®(åç§°ï¼Œipï¼Œç«¯å£)ï¼Ÿ

æ‹¿åˆ°è¿™äº›å…ƒæ•°æ®æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæ‹¿åˆ°äº†æˆ‘ä»¬æ˜¯ä¸æ˜¯ç›´æ¥å¯ä»¥åš**è·¯ç”±æ˜ å°„**ï¼Ÿæ¯”å¦‚åŸæ¥ç”¨æˆ·è°ƒç”¨ `Consumer1` çš„æ¥å£ `localhost:8001/studentInfo/update` è¿™ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è¿™æ ·è¿›è¡Œè°ƒç”¨äº†å‘¢ï¼Ÿ`localhost:9000/consumer1/studentInfo/update` å‘¢ï¼Ÿä½ è¿™æ ·æ˜¯ä¸æ˜¯æç„¶å¤§æ‚Ÿäº†ï¼Ÿ

> è¿™é‡Œçš„urlä¸ºäº†è®©æ›´å¤šäººçœ‹æ‡‚æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ restful é£æ ¼ã€‚

ä¸Šé¢çš„ä½ ç†è§£äº†ï¼Œé‚£ä¹ˆå°±èƒ½ç†è§£å…³äº `Zuul` æœ€åŸºæœ¬çš„é…ç½®äº†ï¼Œçœ‹ä¸‹é¢ã€‚

```yaml
server:
  port: 9000
eureka:
  client:
    service-url:
      # è¿™é‡Œåªè¦æ³¨å†Œ Eureka å°±è¡Œäº†
      defaultZone: http://localhost:9997/eurekaCopy to clipboardErrorCopied
```

ç„¶ååœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥ `@EnableZuulProxy` æ³¨è§£å°±è¡Œäº†ã€‚æ²¡é”™ï¼Œå°±æ˜¯é‚£ä¹ˆç®€å•![smiley](https://gitee.com/aaronlynn/picture/raw/master/img/1f603.png)ã€‚

#### [ç»Ÿä¸€å‰ç¼€](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ç»Ÿä¸€å‰ç¼€)

è¿™ä¸ªå¾ˆç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨å‰é¢åŠ ä¸€ä¸ªç»Ÿä¸€çš„å‰ç¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆšåˆšè°ƒç”¨çš„æ˜¯ `localhost:9000/consumer1/studentInfo/update`ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨ `yaml` é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ã€‚

```yaml
zuul:
  prefix: /zuulCopy to clipboardErrorCopied
```

è¿™æ ·æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ `localhost:9000/zuul/consumer1/studentInfo/update` æ¥è¿›è¡Œè®¿é—®äº†ã€‚

#### [è·¯ç”±ç­–ç•¥é…ç½®](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=è·¯ç”±ç­–ç•¥é…ç½®)

ä½ ä¼šå‘ç°å‰é¢çš„è®¿é—®æ–¹å¼(ç›´æ¥ä½¿ç”¨æœåŠ¡å)ï¼Œéœ€è¦å°†å¾®æœåŠ¡åç§°æš´éœ²ç»™ç”¨æˆ·ï¼Œä¼šå­˜åœ¨å®‰å…¨æ€§é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è‡ªå®šä¹‰è·¯å¾„æ¥æ›¿ä»£å¾®æœåŠ¡åç§°ï¼Œå³è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ã€‚

```yaml
zuul:
  routes:
    consumer1: /FrancisQ1/**
    consumer2: /FrancisQ2/**Copy to clipboardErrorCopied
```

è¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥ä½¿ç”¨ ` `localhost:9000/zuul/FrancisQ1/studentInfo/update` è¿›è¡Œè®¿é—®äº†ã€‚

#### [æœåŠ¡åå±è”½](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=æœåŠ¡åå±è”½)

è¿™ä¸ªæ—¶å€™ä½ åˆ«ä»¥ä¸ºä½ å¥½äº†ï¼Œä½ å¯ä»¥è¯•è¯•ï¼Œåœ¨ä½ é…ç½®å®Œè·¯ç”±ç­–ç•¥ä¹‹åä½¿ç”¨å¾®æœåŠ¡åç§°è¿˜æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œè¿™ä¸ªæ—¶å€™ä½ éœ€è¦å°†æœåŠ¡åå±è”½ã€‚

```yaml
zuul:
  ignore-services: "*"Copy to clipboardErrorCopied
```

#### [è·¯å¾„å±è”½](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=è·¯å¾„å±è”½)

`Zuul` è¿˜å¯ä»¥æŒ‡å®šå±è”½æ‰çš„è·¯å¾„ URIï¼Œå³åªè¦ç”¨æˆ·è¯·æ±‚ä¸­åŒ…å«æŒ‡å®šçš„ URI è·¯å¾„ï¼Œé‚£ä¹ˆè¯¥è¯·æ±‚å°†æ— æ³•è®¿é—®åˆ°æŒ‡å®šçš„æœåŠ¡ã€‚é€šè¿‡è¯¥æ–¹å¼å¯ä»¥é™åˆ¶ç”¨æˆ·çš„æƒé™ã€‚

```yaml
zuul:
  ignore-patterns: **/auto/**Copy to clipboardErrorCopied
```

è¿™æ ·å…³äº auto çš„è¯·æ±‚æˆ‘ä»¬å°±å¯ä»¥è¿‡æ»¤æ‰äº†ã€‚

> ** ä»£è¡¨åŒ¹é…å¤šçº§ä»»æ„è·¯å¾„
>
> *ä»£è¡¨åŒ¹é…ä¸€çº§ä»»æ„è·¯å¾„

#### [æ•æ„Ÿè¯·æ±‚å¤´å±è”½](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=æ•æ„Ÿè¯·æ±‚å¤´å±è”½)

é»˜è®¤æƒ…å†µä¸‹ï¼Œåƒ `Cookie`ã€`Set-Cookie` ç­‰æ•æ„Ÿè¯·æ±‚å¤´ä¿¡æ¯ä¼šè¢« `zuul` å±è”½æ‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›é»˜è®¤å±è”½å»æ‰ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ·»åŠ è¦å±è”½çš„è¯·æ±‚å¤´ã€‚

### [Zuul çš„è¿‡æ»¤åŠŸèƒ½](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=zuul-çš„è¿‡æ»¤åŠŸèƒ½)

å¦‚æœè¯´ï¼Œè·¯ç”±åŠŸèƒ½æ˜¯ `Zuul` çš„åŸºæ“çš„è¯ï¼Œé‚£ä¹ˆ**è¿‡æ»¤å™¨**å°±æ˜¯ `Zuul`çš„åˆ©å™¨äº†ã€‚æ¯•ç«Ÿæ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡ç½‘å…³(Zuul)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œå„ç§è¿‡æ»¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å®ç° **é™æµ**ï¼Œ**ç°åº¦å‘å¸ƒ**ï¼Œ**æƒé™æ§åˆ¶** ç­‰ç­‰ã€‚

#### [ç®€å•å®ç°ä¸€ä¸ªè¯·æ±‚æ—¶é—´æ—¥å¿—æ‰“å°](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ç®€å•å®ç°ä¸€ä¸ªè¯·æ±‚æ—¶é—´æ—¥å¿—æ‰“å°)

è¦å®ç°è‡ªå·±å®šä¹‰çš„ `Filter` æˆ‘ä»¬åªéœ€è¦ç»§æ‰¿ `ZuulFilter` ç„¶åå°†è¿™ä¸ªè¿‡æ»¤å™¨ç±»ä»¥ `@Component` æ³¨è§£åŠ å…¥ Spring å®¹å™¨ä¸­å°±è¡Œäº†ã€‚

åœ¨ç»™ä½ ä»¬çœ‹ä»£ç ä¹‹å‰æˆ‘å…ˆç»™ä½ ä»¬è§£é‡Šä¸€ä¸‹å…³äºè¿‡æ»¤å™¨çš„ä¸€äº›æ³¨æ„ç‚¹ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/zuul-sj22o93nfdsjkdsf2312244.jpg)

è¿‡æ»¤å™¨ç±»å‹ï¼š`Pre`ã€`Routing`ã€`Post`ã€‚å‰ç½®`Pre`å°±æ˜¯åœ¨è¯·æ±‚ä¹‹å‰è¿›è¡Œè¿‡æ»¤ï¼Œ`Routing`è·¯ç”±è¿‡æ»¤å™¨å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è®²çš„è·¯ç”±ç­–ç•¥ï¼Œè€Œ`Post`åç½®è¿‡æ»¤å™¨å°±æ˜¯åœ¨ `Response` ä¹‹å‰è¿›è¡Œè¿‡æ»¤çš„è¿‡æ»¤å™¨ã€‚ä½ å¯ä»¥è§‚å¯Ÿä¸Šå›¾ç»“åˆç€ç†è§£ï¼Œå¹¶ä¸”ä¸‹é¢æˆ‘ä¼šç»™å‡ºç›¸åº”çš„æ³¨é‡Šã€‚

```java
// åŠ å…¥Springå®¹å™¨
@Component
public class PreRequestFilter extends ZuulFilter {
    // è¿”å›è¿‡æ»¤å™¨ç±»å‹ è¿™é‡Œæ˜¯å‰ç½®è¿‡æ»¤å™¨
    @Override
    public String filterType() {
        return FilterConstants.PRE_TYPE;
    }
    // æŒ‡å®šè¿‡æ»¤é¡ºåº è¶Šå°è¶Šå…ˆæ‰§è¡Œï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªæ‰§è¡Œ
    // å½“ç„¶ä¸æ˜¯åªçœŸæ­£ç¬¬ä¸€ä¸ª åœ¨Zuulå†…ç½®ä¸­æœ‰å…¶ä»–è¿‡æ»¤å™¨ä¼šå…ˆæ‰§è¡Œ
    // é‚£æ˜¯å†™æ­»çš„ æ¯”å¦‚ SERVLET_DETECTION_FILTER_ORDER = -3
    @Override
    public int filterOrder() {
        return 0;
    }
    // ä»€ä¹ˆæ—¶å€™è¯¥è¿›è¡Œè¿‡æ»¤
    // è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›åˆ¤æ–­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›ä¸ç¬¦åˆè§„å®šçš„è¯·æ±‚ç­‰ç­‰
    @Override
    public boolean shouldFilter() {
        return true;
    }
    // å¦‚æœè¿‡æ»¤å™¨å…è®¸é€šè¿‡åˆ™æ€ä¹ˆè¿›è¡Œå¤„ç†
    @Override
    public Object run() throws ZuulException {
        // è¿™é‡Œæˆ‘è®¾ç½®äº†å…¨å±€çš„RequestContextå¹¶è®°å½•äº†è¯·æ±‚å¼€å§‹æ—¶é—´
        RequestContext ctx = RequestContext.getCurrentContext();
        ctx.set("startTime", System.currentTimeMillis());
        return null;
    }
}Copy to clipboardErrorCopied
// lombokçš„æ—¥å¿—
@Slf4j
// åŠ å…¥ Spring å®¹å™¨
@Component
public class AccessLogFilter extends ZuulFilter {
    // æŒ‡å®šè¯¥è¿‡æ»¤å™¨çš„è¿‡æ»¤ç±»å‹
    // æ­¤æ—¶æ˜¯åç½®è¿‡æ»¤å™¨
    @Override
    public String filterType() {
        return FilterConstants.POST_TYPE;
    }
    // SEND_RESPONSE_FILTER_ORDER æ˜¯æœ€åä¸€ä¸ªè¿‡æ»¤å™¨
    // æˆ‘ä»¬æ­¤è¿‡æ»¤å™¨åœ¨å®ƒä¹‹å‰æ‰§è¡Œ
    @Override
    public int filterOrder() {
        return FilterConstants.SEND_RESPONSE_FILTER_ORDER - 1;
    }
    @Override
    public boolean shouldFilter() {
        return true;
    }
    // è¿‡æ»¤æ—¶æ‰§è¡Œçš„ç­–ç•¥
    @Override
    public Object run() throws ZuulException {
        RequestContext context = RequestContext.getCurrentContext();
        HttpServletRequest request = context.getRequest();
        // ä»RequestContextè·å–åŸå…ˆçš„å¼€å§‹æ—¶é—´ å¹¶é€šè¿‡å®ƒè®¡ç®—æ•´ä¸ªæ—¶é—´é—´éš”
        Long startTime = (Long) context.get("startTime");
        // è¿™é‡Œæˆ‘å¯ä»¥è·å–HttpServletRequestæ¥è·å–URIå¹¶ä¸”æ‰“å°å‡ºæ¥
        String uri = request.getRequestURI();
        long duration = System.currentTimeMillis() - startTime;
        log.info("uri: " + uri + ", duration: " + duration / 100 + "ms");
        return null;
    }
}Copy to clipboardErrorCopied
```

ä¸Šé¢å°±ç®€å•å®ç°äº†è¯·æ±‚æ—¶é—´æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œä½ æœ‰æ²¡æœ‰æ„Ÿå—åˆ° `Zuul` è¿‡æ»¤åŠŸèƒ½çš„å¼ºå¤§äº†å‘¢ï¼Ÿ

æ²¡æœ‰ï¼Ÿå¥½çš„ã€é‚£æˆ‘ä»¬å†æ¥ã€‚

#### [ä»¤ç‰Œæ¡¶é™æµ](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä»¤ç‰Œæ¡¶é™æµ)

å½“ç„¶ä¸ä»…ä»…æ˜¯ä»¤ç‰Œæ¡¶é™æµæ–¹å¼ï¼Œ`Zuul` åªè¦æ˜¯é™æµçš„æ´»å®ƒéƒ½èƒ½å¹²ï¼Œè¿™é‡Œæˆ‘åªæ˜¯ç®€å•ä¸¾ä¸ª![chestnut](https://github.githubassets.com/images/icons/emoji/unicode/1f330.png)ã€‚

![ä»¤ç‰Œæ¡¶é™æµ](https://gitee.com/aaronlynn/picture/raw/master/img/zuui-%E4%BB%A4%E7%89%8C%E6%A1%B6%E9%99%90%E6%B5%81.jpg)

æˆ‘å…ˆæ¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ **ä»¤ç‰Œæ¡¶é™æµ** å§ã€‚

é¦–å…ˆæˆ‘ä»¬ä¼šæœ‰ä¸ªæ¡¶ï¼Œå¦‚æœé‡Œé¢æ²¡æœ‰æ»¡é‚£ä¹ˆå°±ä¼šä»¥ä¸€å®š **å›ºå®šçš„é€Ÿç‡** ä¼šå¾€é‡Œé¢æ”¾ä»¤ç‰Œï¼Œä¸€ä¸ªè¯·æ±‚è¿‡æ¥é¦–å…ˆè¦ä»æ¡¶ä¸­è·å–ä»¤ç‰Œï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±æ‹’ç»ï¼Œå¦‚æœè·å–åˆ°é‚£ä¹ˆå°±æ”¾è¡Œã€‚å¾ˆç®€å•å§ï¼Œå•Šå“ˆå“ˆã€

ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡ `Zuul` çš„å‰ç½®è¿‡æ»¤å™¨æ¥å®ç°ä¸€ä¸‹ä»¤ç‰Œæ¡¶é™æµã€‚

```java
package com.lgq.zuul.filter;

import com.google.common.util.concurrent.RateLimiter;
import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;
import org.springframework.stereotype.Component;

@Component
@Slf4j
public class RouteFilter extends ZuulFilter {
    // å®šä¹‰ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œæ¯ç§’äº§ç”Ÿ2ä¸ªä»¤ç‰Œï¼Œå³æ¯ç§’æœ€å¤šå¤„ç†2ä¸ªè¯·æ±‚
    private static final RateLimiter RATE_LIMITER = RateLimiter.create(2);
    @Override
    public String filterType() {
        return FilterConstants.PRE_TYPE;
    }

    @Override
    public int filterOrder() {
        return -5;
    }

    @Override
    public Object run() throws ZuulException {
        log.info("æ”¾è¡Œ");
        return null;
    }

    @Override
    public boolean shouldFilter() {
        RequestContext context = RequestContext.getCurrentContext();
        if(!RATE_LIMITER.tryAcquire()) {
            log.warn("è®¿é—®é‡è¶…è½½");
            // æŒ‡å®šå½“å‰è¯·æ±‚æœªé€šè¿‡è¿‡æ»¤
            context.setSendZuulResponse(false);
            // å‘å®¢æˆ·ç«¯è¿”å›å“åº”ç 429ï¼Œè¯·æ±‚æ•°é‡è¿‡å¤š
            context.setResponseStatusCode(429);
            return false;
        }
        return true;
    }
}Copy to clipboardErrorCopied
```

è¿™æ ·æˆ‘ä»¬å°±èƒ½å°†è¯·æ±‚æ•°é‡æ§åˆ¶åœ¨ä¸€ç§’ä¸¤ä¸ªï¼Œæœ‰æ²¡æœ‰è§‰å¾—å¾ˆé…·ï¼Ÿ

### [å…³äº Zuul çš„å…¶ä»–](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=å…³äº-zuul-çš„å…¶ä»–)

`Zuul` çš„è¿‡æ»¤å™¨çš„åŠŸèƒ½è‚¯å®šä¸æ­¢ä¸Šé¢æˆ‘æ‰€å®ç°çš„ä¸¤ç§ï¼Œå®ƒè¿˜å¯ä»¥å®ç° **æƒé™æ ¡éªŒ**ï¼ŒåŒ…æ‹¬æˆ‘ä¸Šé¢æåˆ°çš„ **ç°åº¦å‘å¸ƒ** ç­‰ç­‰ã€‚

å½“ç„¶ï¼Œ`Zuul` ä½œä¸ºç½‘å…³è‚¯å®šä¹Ÿå­˜åœ¨ **å•ç‚¹é—®é¢˜** ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¿è¯ `Zuul` çš„é«˜å¯ç”¨ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œ `Zuul` çš„é›†ç¾¤é…ç½®ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å€ŸåŠ©é¢å¤–çš„ä¸€äº›è´Ÿè½½å‡è¡¡å™¨æ¯”å¦‚ `Nginx` ã€‚

\##Spring Cloudé…ç½®ç®¡ç†â€”â€”Config

### [ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿›è¡Œé…ç½®ç®¡ç†ï¼Ÿ](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿›è¡Œé…ç½®ç®¡ç†ï¼Ÿ)

å½“æˆ‘ä»¬çš„å¾®æœåŠ¡ç³»ç»Ÿå¼€å§‹æ…¢æ…¢åœ°åºå¤§èµ·æ¥ï¼Œé‚£ä¹ˆå¤š `Consumer` ã€`Provider` ã€`Eureka Server` ã€`Zuul` ç³»ç»Ÿéƒ½ä¼šæŒæœ‰è‡ªå·±çš„é…ç½®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨é¡¹ç›®è¿è¡Œçš„æ—¶å€™å¯èƒ½éœ€è¦æ›´æ”¹æŸäº›åº”ç”¨çš„é…ç½®ï¼Œå¦‚æœæˆ‘ä»¬ä¸è¿›è¡Œé…ç½®çš„ç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘ä»¬åªèƒ½**å»æ¯ä¸ªåº”ç”¨ä¸‹ä¸€ä¸ªä¸€ä¸ªå¯»æ‰¾é…ç½®æ–‡ä»¶ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶å†é‡å¯åº”ç”¨**ã€‚

é¦–å…ˆå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€æˆ‘ä»¬å°±ä¸åº”è¯¥å»æ¯ä¸ªåº”ç”¨ä¸‹å»åˆ†åˆ«ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå†è€…å¯¹äºé‡å¯åº”ç”¨æ¥è¯´ï¼ŒæœåŠ¡æ— æ³•è®¿é—®æ‰€ä»¥ç›´æ¥æŠ›å¼ƒäº†å¯ç”¨æ€§ï¼Œè¿™æ˜¯æˆ‘ä»¬æ›´ä¸æ„¿è§åˆ°çš„ã€‚

é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•**æ—¢èƒ½å¯¹é…ç½®æ–‡ä»¶ç»Ÿä¸€åœ°è¿›è¡Œç®¡ç†ï¼Œåˆèƒ½åœ¨é¡¹ç›®è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ**

é‚£å°±æ˜¯æˆ‘ä»Šå¤©æ‰€è¦ä»‹ç»çš„ `Spring Cloud Config` ã€‚

> èƒ½è¿›è¡Œé…ç½®ç®¡ç†çš„æ¡†æ¶ä¸æ­¢ `Spring Cloud Config` ä¸€ç§ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå·±é€‰æ‹©ï¼ˆ`disconf`ï¼Œé˜¿æ³¢ç½—ç­‰ç­‰ï¼‰ã€‚è€Œä¸”å¯¹äº `Config` æ¥è¯´æœ‰äº›åœ°æ–¹å®ç°çš„ä¸æ˜¯é‚£ä¹ˆå°½äººæ„ã€‚

### [Config æ˜¯ä»€ä¹ˆ](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=config-æ˜¯ä»€ä¹ˆ)

> `Spring Cloud Config` ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®æä¾›æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ”¯æŒã€‚ä½¿ç”¨ `Config` æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨ä¸­å¿ƒä½ç½®ç®¡ç†æ‰€æœ‰ç¯å¢ƒä¸­åº”ç”¨ç¨‹åºçš„å¤–éƒ¨å±æ€§ã€‚

ç®€å•æ¥è¯´ï¼Œ`Spring Cloud Config` å°±æ˜¯èƒ½å°†å„ä¸ª åº”ç”¨/ç³»ç»Ÿ/æ¨¡å— çš„é…ç½®æ–‡ä»¶å­˜æ”¾åˆ° **ç»Ÿä¸€çš„åœ°æ–¹ç„¶åè¿›è¡Œç®¡ç†**(Git æˆ–è€… SVN)ã€‚

ä½ æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸æ˜¯åªæœ‰å¯åŠ¨çš„æ—¶å€™æ‰ä¼šè¿›è¡Œé…ç½®æ–‡ä»¶çš„åŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ `Spring Cloud Config` å°±æš´éœ²å‡ºä¸€ä¸ªæ¥å£ç»™å¯åŠ¨åº”ç”¨æ¥è·å–å®ƒæ‰€æƒ³è¦çš„é…ç½®æ–‡ä»¶ï¼Œåº”ç”¨è·å–åˆ°é…ç½®æ–‡ä»¶ç„¶åå†è¿›è¡Œå®ƒçš„åˆå§‹åŒ–å·¥ä½œã€‚å°±å¦‚ä¸‹å›¾ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/config-ksksks.jpg)

å½“ç„¶è¿™é‡Œä½ è‚¯å®šè¿˜ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœæˆ‘åœ¨åº”ç”¨è¿è¡Œæ—¶å»æ›´æ”¹è¿œç¨‹é…ç½®ä»“åº“(Git)ä¸­çš„å¯¹åº”é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆä¾èµ–äºè¿™ä¸ªé…ç½®æ–‡ä»¶çš„å·²å¯åŠ¨çš„åº”ç”¨ä¼šä¸ä¼šè¿›è¡Œå…¶ç›¸åº”é…ç½®çš„æ›´æ”¹å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯ä¸ä¼šçš„ã€‚

ä»€ä¹ˆï¼Ÿé‚£æ€ä¹ˆè¿›è¡ŒåŠ¨æ€ä¿®æ”¹é…ç½®æ–‡ä»¶å‘¢ï¼Ÿè¿™ä¸æ˜¯å‡ºç°äº† **é…ç½®æ¼‚ç§»** å—ï¼Ÿä½ ä¸ªæ¸£ç”·![rage](https://gitee.com/aaronlynn/picture/raw/master/img/1f621.png)ï¼Œä½ åˆéª—æˆ‘ï¼

åˆ«æ€¥å˜›ï¼Œä½ å¯ä»¥ä½¿ç”¨ `Webhooks` ï¼Œè¿™æ˜¯ `github` æä¾›çš„åŠŸèƒ½ï¼Œå®ƒèƒ½ç¡®ä¿è¿œç¨‹åº“çš„é…ç½®æ–‡ä»¶æ›´æ–°åå®¢æˆ·ç«¯ä¸­çš„é…ç½®ä¿¡æ¯ä¹Ÿå¾—åˆ°æ›´æ–°ã€‚

å™¢å™¢ï¼Œè¿™è¿˜å·®ä¸å¤šã€‚æˆ‘å»æŸ¥æŸ¥æ€ä¹ˆç”¨ã€‚

æ…¢ç€ï¼Œå¬æˆ‘è¯´å®Œï¼Œ`Webhooks` è™½ç„¶èƒ½è§£å†³ï¼Œä½†æ˜¯ä½ äº†è§£ä¸€ä¸‹ä¼šå‘ç°å®ƒæ ¹æœ¬ä¸é€‚åˆç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œæ‰€ä»¥åŸºæœ¬ä¸ä¼šä½¿ç”¨å®ƒçš„ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/1ada747175704ecba3507074847002d0-new-imagee5249fee-c5ee-4472-9983-f1bd5801387c.png)

è€Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨ `Bus` æ¶ˆæ¯æ€»çº¿ + `Spring Cloud Config` è¿›è¡Œé…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚

## [å¼•å‡º Spring Cloud Bus](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=å¼•å‡º-spring-cloud-bus)

> ç”¨äºå°†æœåŠ¡å’ŒæœåŠ¡å®ä¾‹ä¸åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥åœ¨ä¸€èµ·çš„äº‹ä»¶æ€»çº¿ã€‚åœ¨é›†ç¾¤ä¸­ä¼ æ’­çŠ¶æ€æ›´æ”¹å¾ˆæœ‰ç”¨ï¼ˆä¾‹å¦‚é…ç½®æ›´æ”¹äº‹ä»¶ï¼‰ã€‚

ä½ å¯ä»¥ç®€å•ç†è§£ä¸º `Spring Cloud Bus` çš„ä½œç”¨å°±æ˜¯**ç®¡ç†å’Œå¹¿æ’­åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¶ˆæ¯**ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯å¼•æ“ç³»ç»Ÿä¸­çš„å¹¿æ’­æ¨¡å¼ã€‚å½“ç„¶ä½œä¸º **æ¶ˆæ¯æ€»çº¿** çš„ `Spring Cloud Bus` å¯ä»¥åšå¾ˆå¤šäº‹è€Œä¸ä»…ä»…æ˜¯å®¢æˆ·ç«¯çš„é…ç½®åˆ·æ–°åŠŸèƒ½ã€‚

è€Œæ‹¥æœ‰äº† `Spring Cloud Bus` ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„è¯·æ±‚ï¼Œå¹¶ä¸”åŠ ä¸Š `@ResfreshScope` æ³¨è§£å°±èƒ½è¿›è¡Œé…ç½®çš„åŠ¨æ€ä¿®æ”¹äº†ï¼Œä¸‹é¢æˆ‘ç”»äº†å¼ å›¾ä¾›ä½ ç†è§£ã€‚

![img](https://gitee.com/aaronlynn/picture/raw/master/img/springcloud-bus-s213dsfsd.jpg)

## [æ€»ç»“](https://snailclimb.gitee.io/javaguide/#/docs/system-design/micro-service/spring-cloud?id=æ€»ç»“)

è¿™ç¯‡æ–‡ç« ä¸­æˆ‘å¸¦å¤§å®¶åˆæ­¥äº†è§£äº† `Spring Cloud` çš„å„ä¸ªç»„ä»¶ï¼Œä»–ä»¬æœ‰

- `Eureka` æœåŠ¡å‘ç°æ¡†æ¶
- `Ribbon` è¿›ç¨‹å†…è´Ÿè½½å‡è¡¡å™¨
- `Open Feign` æœåŠ¡è°ƒç”¨æ˜ å°„
- `Hystrix` æœåŠ¡é™çº§ç†”æ–­å™¨
- `Zuul` å¾®æœåŠ¡ç½‘å…³
- `Config` å¾®æœåŠ¡ç»Ÿä¸€é…ç½®ä¸­å¿ƒ
- `Bus` æ¶ˆæ¯æ€»çº¿

å¦‚æœä½ èƒ½è¿™ä¸ªæ—¶å€™èƒ½çœ‹æ‡‚æ–‡é¦–é‚£å¼ å›¾ï¼Œä¹Ÿå°±è¯´æ˜äº†ä½ å·²ç»å¯¹ `Spring Cloud` å¾®æœåŠ¡æœ‰äº†ä¸€å®šçš„æ¶æ„è®¤è¯†ã€‚
---
> > æœ¬æ–‡åŸºäº Spring Cloud Netflix ã€‚Spring Cloud Alibaba ä¹Ÿæ˜¯éå¸¸ä¸é”™çš„é€‰æ‹©å“¦ï¼
>
> æˆæƒè½¬è½½è‡ªï¼šhttps://juejin.im/post/5de2553e5188256e885f4fa3
